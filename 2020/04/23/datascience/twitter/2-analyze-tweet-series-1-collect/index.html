<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1">


  <link rel="mask-icon" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-1156366976077024",
          enable_page_level_ads: true
     });
</script>

  <meta name="description" content="트위터 데이터를 주로 수집해서 사용하다 보니, 너무 관련된 포스트를 여러개 쓰는것 같지만..많은 분들이 댓글 혹은 메일로도 연락이 오셔서 문의하시는 부분이 있어 이 기회에 정리해 보고자 한다. 이름하여 트위터 파헤치기 시리즈! 수집부터 시작해서 한국어 전처리, 워드 클라우드 시각화 및 클러스터링 시 적절한 하이퍼 파라미터 설정 등 분석 단계까지 조금씩 정리">
<meta name="keywords" content="Python,Datamining,Twitter">
<meta property="og:type" content="article">
<meta property="og:title" content="트위터 파헤치기 시리즈 첫번째 - 수집하기">
<meta property="og:url" content="https://jeongwookie.github.io/2020/04/23/datascience/twitter/2-analyze-tweet-series-1-collect/index.html">
<meta property="og:site_name" content="JW&#39;s Blog">
<meta property="og:description" content="트위터 데이터를 주로 수집해서 사용하다 보니, 너무 관련된 포스트를 여러개 쓰는것 같지만..많은 분들이 댓글 혹은 메일로도 연락이 오셔서 문의하시는 부분이 있어 이 기회에 정리해 보고자 한다. 이름하여 트위터 파헤치기 시리즈! 수집부터 시작해서 한국어 전처리, 워드 클라우드 시각화 및 클러스터링 시 적절한 하이퍼 파라미터 설정 등 분석 단계까지 조금씩 정리">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://user-images.githubusercontent.com/25416425/80474558-8ea2a900-8982-11ea-99b0-e1cef6218e03.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/25416425/80477180-79c81480-8986-11ea-96f3-5edd1718aaaa.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/25416425/80562211-05db4a00-8a22-11ea-973a-8416eff25eab.png">
<meta property="og:updated_time" content="2021-11-21T11:21:38.807Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="트위터 파헤치기 시리즈 첫번째 - 수집하기">
<meta name="twitter:description" content="트위터 데이터를 주로 수집해서 사용하다 보니, 너무 관련된 포스트를 여러개 쓰는것 같지만..많은 분들이 댓글 혹은 메일로도 연락이 오셔서 문의하시는 부분이 있어 이 기회에 정리해 보고자 한다. 이름하여 트위터 파헤치기 시리즈! 수집부터 시작해서 한국어 전처리, 워드 클라우드 시각화 및 클러스터링 시 적절한 하이퍼 파라미터 설정 등 분석 단계까지 조금씩 정리">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/25416425/80474558-8ea2a900-8982-11ea-99b0-e1cef6218e03.png">



  <link rel="alternate" href="/atom.xml" title="JW's Blog" type="application/atom+xml">




  <link rel="canonical" href="https://jeongwookie.github.io/2020/04/23/datascience/twitter/2-analyze-tweet-series-1-collect/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>트위터 파헤치기 시리즈 첫번째 - 수집하기 | JW's Blog</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-125636294-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-125636294-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JW's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Make stuff people want</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="https://www.notion.so/jeongwookie93/Jeong-Wook-Kim-03e882670c1949a99d8b408d9785468f" rel="external nofollow noopener noreferrer" target="_blank"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/jeongwookie" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow noopener noreferrer" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jeongwookie.github.io/2020/04/23/datascience/twitter/2-analyze-tweet-series-1-collect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeongwook, Kim">
      <meta itemprop="description" content="Love code, travel, and game">
      <meta itemprop="image" content="https://user-images.githubusercontent.com/25416425/59519549-10245080-8f03-11e9-9a48-21e99af119f3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JW's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">트위터 파헤치기 시리즈 첫번째 - 수집하기

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-04-23 17:38:46" itemprop="dateCreated datePublished" datetime="2020-04-23T17:38:46+09:00">2020-04-23</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ⅰ-Data-Science/" itemprop="url" rel="index"><span itemprop="name">Ⅰ. Data Science</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ⅰ-Data-Science/트위터-데이터-분석하기/" itemprop="url" rel="index"><span itemprop="name">트위터 데이터 분석하기</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2020/04/23/datascience/twitter/2-analyze-tweet-series-1-collect/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/04/23/datascience/twitter/2-analyze-tweet-series-1-collect/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>트위터 데이터를 주로 수집해서 사용하다 보니, 너무 관련된 포스트를 여러개 쓰는것 같지만..<br>많은 분들이 댓글 혹은 메일로도 연락이 오셔서 문의하시는 부분이 있어 이 기회에 정리해 보고자 한다.</p>
<p>이름하여 <strong>트위터 파헤치기 시리즈!</strong> 수집부터 시작해서 한국어 전처리, 워드 클라우드 시각화 및 클러스터링 시 적절한 하이퍼 파라미터 설정 등 분석 단계까지 조금씩 정리해 보고자 한다.</p>
<p>예시 주제로 요즘 우리들을 괴롭히는 <strong>코로나 바이러스</strong> 에 대해서 트위터를 살펴보는 것으로 정했다.</p>
<p>지금까지 트위터 수집 방법에 대해서 꽤 여러 포스트를 썼었는데, 지금까지 다루지 않은 방법으로 시도하고자 한다. 수집 방법을 많이 알면 알수록 좋으니까! </p>
<p><img src="https://user-images.githubusercontent.com/25416425/80474558-8ea2a900-8982-11ea-99b0-e1cef6218e03.png" width="500"></p>
<a id="more"></a>
<h2 id="수집-도구-정하기"><a href="#수집-도구-정하기" class="headerlink" title="수집 도구 정하기"></a>수집 도구 정하기</h2><p>이번에 트위터 수집에 사용할 패키지는 <code>twint</code> 라는 친구이다.<br>(github page : <a href="https://github.com/twintproject/twint" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/twintproject/twint</a>)</p>
<p>무료로 사용할 수 있고, 트위터 개발자 등록 과정이 필요가 없어서 간단하게 트랜드나 토픽을 알고 싶을때 사용하곤 했다.</p>
<p>돈 내고 쓰는 것이 아니기 때문에 조금씩 불편한 점들이 있다. 그러나 현존하는 무료 파이썬 패키지 중에 가장 잘 작동하는 트위터 크롤링 패키지가 아닐까 싶다.</p>
<p>full-archive 트위터 데이터가 필요한 연구자라면 본 패키지는 불필요하다. Premium API를 결제해서 사용하도록 하자. 본인이 시도해본 결과 프리미엄에 비해 10~20%의 데이터밖에 크롤링하지 못한다.</p>
<p>그러나, 하루에 어떤 토픽이 이슈가 되었고 전반적인 트랜드를 알고 싶은 사용자라면 이것으로 충분하다.</p>
<p>아래부터 코드는 주피터 노트북으로 열어서 실행하는 것을 기본으로 전제하고 작성한다. <code>twint</code>를 설치부터 해주자.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># python 3.6 </span><br><span class="line"># install twint package</span><br><span class="line">!pip install --user --upgrade -e git+https://github.com/twintproject/twint.git@origin/master#egg=twint</span><br></pre></td></tr></table></figure>
<p>깃허브 홈페이지를 들어가보면 pip 설치 이외에도 설치 방법이 다양하게 나와있다. (Python 3.6 기준)</p>
<h2 id="파라미터-설정하기"><a href="#파라미터-설정하기" class="headerlink" title="파라미터 설정하기"></a>파라미터 설정하기</h2><p><code>twint</code> 패키지는 거의 대부분의 Twitter API 가 지원하는 옵션을 동일하게 지원한다. 자세한 사용법은 본 포스트에서는 다루지 않을 생각이다. wiki를 읽어보면 혼자서 할 수 있도록 설명이 잘 되어 있기 때문이다.</p>
<p>본 포스트의 목적은 <strong>코로나 바이러스</strong> 에 관한 트윗을 수집하는 것이므로, 여기에 초점을 맞춰서 파라미터를 설정해 보겠다. 설정하면서 등장하는 <code>twint</code> 옵션에 대해서는 간단하게 설명을 달아놓는 것으로.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> twint</span><br><span class="line">c = twint.Config() <span class="comment"># twint config 선언</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parameter setting</span></span><br><span class="line">c.Limit = <span class="number">50</span></span><br><span class="line">c.Search = <span class="string">'코로나 OR 우한 폐렴'</span></span><br><span class="line">c.Since = <span class="string">'2020-04-23'</span></span><br><span class="line">c.Until = <span class="string">'2020-04-24'</span></span><br><span class="line">c.Output = <span class="string">'covid19_sample_tweet.json'</span></span><br><span class="line">c.Popular_tweets = <span class="literal">True</span></span><br><span class="line">c.Store_json = <span class="literal">True</span></span><br><span class="line">c.Hide_output = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>옵션이 생각보다 많다.. 위의 코드에 사용된 옵션에 대해서 하나하나 알아보자.</p>
<ul>
<li>Limit: 총 수집할 트윗의 수를 의미 (모든 트윗을 수집하고 싶다면 옵션을 제거)</li>
<li>Search: 수집할 트윗의 키워드를 입력, <strong>Exact Match</strong>를 원하면 쌍따옴표를 사용<br>(ex. ‘코로나 OR “우한 폐렴”‘ 으로 입력할 경우, 정확히 우한 폐렴 이라는 단어를 모두 포함하는 트윗만 수집됨)</li>
<li>Since, Until: 수집을 원하는 기간 범위 (끝은 포함하지 않음)</li>
<li>Output: 트윗을 수집 후 저장할 때 파일 이름</li>
<li>Popular_tweets: <code>True</code>일 때 트위터 탭 중 Polular을 의미, <code>False</code>의 경우 Recent을 의미</li>
<li>Store_json: 저장 시 JSON 포맷으로</li>
<li>Hide_output: <code>True</code>일 때 주피터 노트북 콘솔에 output이 출력되는 옵션을 끔</li>
</ul>
<p>더 원하는 옵션이 있거나, 설명을 보고도 잘 이해하기 어렵다면 <a href="https://github.com/twintproject/twint/wiki/Configuration" rel="external nofollow noopener noreferrer" target="_blank">공식 홈페이지</a>의 설명을 참고하자.</p>
<h2 id="트위터-수집하기"><a href="#트위터-수집하기" class="headerlink" title="트위터 수집하기"></a>트위터 수집하기</h2><p>자, 설정은 끝났다. 이제 위에서 설정한 <code>twint</code>을 실행시켜 볼 것이다. 아래의 코드를 입력한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">twint.run.Search(c)</span><br></pre></td></tr></table></figure>
<p>위의 옵션에서 나는 “트위터에서 코로나 또는 우한 폐렴을 포함하는 트윗을 2020년 4월 23일 (UTC), Popular 탭 기준으로 50개만 수집해줘” 를 주문했다.</p>
<p>제대로 실행되었다면, working directory에 <code>covid19_sample_tweet.json</code> 파일이 생성되었을 것이다. 뜯어서 살펴보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.read_json(<span class="string">'covid19_sample_tweet.json'</span>, lines=<span class="literal">True</span>)</span><br><span class="line">df[[<span class="string">"created_at"</span>, <span class="string">"id"</span>, <span class="string">"tweet"</span>, <span class="string">"retweets_count"</span>]].head() <span class="comment"># 편의상 4개의 칼럼만 출력</span></span><br></pre></td></tr></table></figure>
<p><img src="https://user-images.githubusercontent.com/25416425/80477180-79c81480-8986-11ea-96f3-5edd1718aaaa.png" width="750"></p>
<p>위와 같이 4월 23일의 트윗이 잘 수집되었음을 확인할 수 있다.</p>
<h2 id="크롤러-만들기"><a href="#크롤러-만들기" class="headerlink" title="크롤러 만들기"></a>크롤러 만들기</h2><p>위까지 잘 따라왔다면 <code>twint</code>를 사용해서 하루 단위의 트윗을 어떻게 모으는지 알았을 것이다.<br>이제 loop를 구성해서, 주어진 기간 내 특정 트윗을 모두 수집하도록 코드를 구성해 보자.<br>이쯤 되면 트위터 크롤러라고 이름을 붙여도 될 것이다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import packages</span></span><br><span class="line"><span class="keyword">import</span> twint</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> mkdir, path</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># Valid Directory Naming Function</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_name</span><span class="params">(term)</span>:</span></span><br><span class="line">    cleaned = re.sub(<span class="string">'[^0-9a-zA-Zㄱ-ㅎ가-힣]'</span>, <span class="string">''</span>, term) <span class="comment"># 특수문자 제거</span></span><br><span class="line">    <span class="keyword">return</span> cleaned</span><br><span class="line"></span><br><span class="line"><span class="comment"># Twint Search Function</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">twint_search</span><span class="params">(dirname, searchterm, since, until, json_name, limit)</span>:</span></span><br><span class="line"></span><br><span class="line">    c = twint.Config()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Parameter setting</span></span><br><span class="line">    c.Limit = limit</span><br><span class="line">    c.Search = searchterm</span><br><span class="line">    c.Since = since</span><br><span class="line">    c.Until = until</span><br><span class="line">    c.Hide_output = <span class="literal">True</span></span><br><span class="line">    c.Store_json = <span class="literal">True</span></span><br><span class="line">    c.Output = json_name</span><br><span class="line">    c.Debug = <span class="literal">True</span></span><br><span class="line">    c.Resume = <span class="string">f'<span class="subst">&#123;dirname&#125;</span>/save_endpoint/save_endpoint_<span class="subst">&#123;since&#125;</span>.txt'</span></span><br><span class="line">    c.Popular_tweets = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        twint.run.Search(c)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> (KeyboardInterrupt, SystemExit):</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">f"Problem with <span class="subst">&#123;since&#125;</span>."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Loop Function, Default number of tweet is 50</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">twint_loop</span><span class="params">(searchterm, since, until, limit=<span class="number">50</span>)</span>:</span></span><br><span class="line">    </span><br><span class="line">    dirname = clean_name(searchterm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Create target directory</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        mkdir(dirname)</span><br><span class="line">        mkdir(<span class="string">f'<span class="subst">&#123;dirname&#125;</span>/save_endpoint'</span>)</span><br><span class="line">        print(<span class="string">"Directory"</span> , dirname ,  <span class="string">"Created "</span>)</span><br><span class="line">    <span class="keyword">except</span> FileExistsError:</span><br><span class="line">        print(<span class="string">"Directory"</span> , dirname ,  <span class="string">"already exists"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Loop </span></span><br><span class="line">    daterange = pd.date_range(since, until)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> start_date <span class="keyword">in</span> daterange:</span><br><span class="line"></span><br><span class="line">        since = start_date.strftime(<span class="string">"%Y-%m-%d"</span>)</span><br><span class="line">        until = (start_date + timedelta(days=<span class="number">1</span>)).strftime(<span class="string">"%Y-%m-%d"</span>)</span><br><span class="line"></span><br><span class="line">        json_name = <span class="string">""</span>.join(since.split(<span class="string">"-"</span>)) + <span class="string">".json"</span></span><br><span class="line">        json_name = path.join(dirname, json_name)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">f'Getting <span class="subst">&#123;since&#125;</span> '</span>)</span><br><span class="line">        twint_search(dirname, searchterm, since, until, json_name, limit)</span><br></pre></td></tr></table></figure>
<p>조금 함수의 형태들이 마음에 들지 않지만, 작동은 잘 한다.<br>따로 값을 지정하지 않으면 기본적으로 각 날짜에 대해 50개의 트윗만 가져오도록 설정했다.<br>50개의 트윗을 시간 순서대로 가져오고 싶다면 옵션 중 <code>Popular_tweets</code>을 <code>False</code>로 지정하면 된다.</p>
<p>위의 섹션에서 다루지 않은 옵션이 있는데, <code>Debug</code> 와 <code>Resume</code>이다. 이는 대량의 트윗을 수집할 때 <code>twint</code>가 트위터 서버 측의 공격적인 크롤링 방지로 인해 TimeoutError를 발생시키기 때문에, 중간 저장 포인트를 만들기 위해 설정한 것이다.</p>
<p>일단 실행 고고!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Keyword = <span class="string">'코로나 OR 우한 폐렴'</span></span><br><span class="line">twint_loop(Keyword, <span class="string">'2020-04-23'</span>, <span class="string">'2020-04-25'</span>, limit=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 실행 화면</span></span><br><span class="line">&gt;&gt; Directory 코로나OR우한폐렴 Created</span><br><span class="line">&gt;&gt; Getting <span class="number">2020</span><span class="number">-04</span><span class="number">-23</span> </span><br><span class="line">&gt;&gt; Getting <span class="number">2020</span><span class="number">-04</span><span class="number">-24</span> </span><br><span class="line">&gt;&gt; Getting <span class="number">2020</span><span class="number">-04</span><span class="number">-25</span></span><br></pre></td></tr></table></figure>
<p>위와 같이 2020년 4월 23일부터 25일까지 트윗이 잘 수집됨을 확인할 수 있다.</p>
<p>Limit을 -1로 설정하면 조건을 만족하는 모든 트윗을 가져오게 되는데, 경우에 따라 몇 시간에서 몇십 시간이 소요될 수도 있다. (covid19와 같은 search 조건을 입력하면 그렇게 된다..)</p>
<p>그리고 너무 오랫동안 크롤러가 작동하게 되면 알수 없는 이유로 오류를 일으키는 경우가 간간히 존재한다. 경험적으로 크롤러가 끊어지는 부분들을 많이 보완한 코드가 위의 코드인데.. 문제들을 완전히 해결하고 싶다면 유료 버전을 검토해 보자.</p>
<p>수집된 내용을 확인해 볼까?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> tqdm.auto <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># Saved files path</span></span><br><span class="line">DATA_DIR = Path(<span class="string">f"./<span class="subst">&#123;clean_name(Keyword)&#125;</span>"</span>) <span class="comment"># 저장된 파일 디렉토리 정보</span></span><br><span class="line">json_files = [pos_json <span class="keyword">for</span> pos_json <span class="keyword">in</span> os.listdir(DATA_DIR) <span class="keyword">if</span> pos_json.endswith(<span class="string">'.json'</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Data load</span></span><br><span class="line">df_list= []</span><br><span class="line"><span class="keyword">for</span> file_name <span class="keyword">in</span> tqdm(json_files):</span><br><span class="line">    temp_df = pd.read_json(DATA_DIR / file_name, lines=<span class="literal">True</span>)</span><br><span class="line">    df_list.append(temp_df)</span><br><span class="line">    </span><br><span class="line">df = pd.concat(df_list, sort=<span class="literal">False</span>)</span><br><span class="line">df[[<span class="string">"created_at"</span>, <span class="string">"id"</span>, <span class="string">"tweet"</span>, <span class="string">"retweets_count"</span>]].tail() <span class="comment"># 편의상 4개의 칼럼만 출력</span></span><br></pre></td></tr></table></figure>
<p><img src="https://user-images.githubusercontent.com/25416425/80562211-05db4a00-8a22-11ea-973a-8416eff25eab.png" width="750"></p>
<p>수집이 잘 이루어졌음을 확인할 수 있다.</p>
<p>또한 위의 코드에는 여러개의 JSON 파일을 한번에 읽는 방법도 포함되어 있다.<br>하나의 JSON 파일에 너무 많은 트윗이 포함되어 있다면 읽는 데에도 시간이 오래 걸리니 유의하자.<br>통째로 묶어서 <code>df</code>에 저장하도록 되어 있는데, 트윗의 수가 몇 백만개가 넘어가면 Memory Error가 발생할 수 있다.<br>얼마나 읽어졌는지 눈으로 확인하기 위해 <code>tqdm</code>을 추가하였다. 오류가 난다면 제거해도 상관없다.</p>
<p>다음 포스트에서는 위와 같은 방법으로 수집한 트윗에 대해 한국어 NLP에서 가장 고충을 겪고 있는 점 중 하나인 전처리 (preprocessing)에 대해 다루어 볼 계획이다.</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/Datamining/" rel="tag"># Datamining</a>
          
            <a href="/tags/Twitter/" rel="tag"># Twitter</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/24/deeplearning/1-pytorch-cuda-gpu-allocate/" rel="next" title="Pytorch 특정 GPU 사용하기">
                <i class="fa fa-chevron-left"></i> Pytorch 특정 GPU 사용하기
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/04/29/datascience/twitter/3-analyze-tweet-series-2-preprocessing/" rel="prev" title="트위터 파헤치기 시리즈 두번째 - 한국어 전처리">
                트위터 파헤치기 시리즈 두번째 - 한국어 전처리 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://user-images.githubusercontent.com/25416425/59519549-10245080-8f03-11e9-9a48-21e99af119f3.jpg" alt="Jeongwook, Kim">
            
              <p class="site-author-name" itemprop="name">Jeongwook, Kim</p>
              <div class="site-description motion-element" itemprop="description">Love code, travel, and game</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">56</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">35</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/jeongwookie" title="Github &rarr; https://github.com/jeongwookie" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:captainfox@kaist.ac.kr" title="E-Mail &rarr; mailto:captainfox@kaist.ac.kr" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://www.linkedin.com/in/jeongwook-kim/" title="linkedin &rarr; https://www.linkedin.com/in/jeongwook-kim/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#수집-도구-정하기"><span class="nav-number">1.</span> <span class="nav-text">수집 도구 정하기</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#파라미터-설정하기"><span class="nav-number">2.</span> <span class="nav-text">파라미터 설정하기</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#트위터-수집하기"><span class="nav-number">3.</span> <span class="nav-text">트위터 수집하기</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#크롤러-만들기"><span class="nav-number">4.</span> <span class="nav-text">크롤러 만들기</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      
    </div>
    <div class="gooAd sidebar-inner" style"display: block;">
      <!-- Google AdSense start -->
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- jw google ad 1 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1156366976077024" data-ad-slot="2477415640" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
      <!-- Google AdSense end -->
    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeongwook, Kim</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> v3.8.0</div>








        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://jeongwookie.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "https://jeongwookie.github.io/2020/04/23/datascience/twitter/2-analyze-tweet-series-1-collect/";
    this.page.identifier = "2020/04/23/datascience/twitter/2-analyze-tweet-series-1-collect/";
    this.page.title = '트위터 파헤치기 시리즈 첫번째 - 수집하기';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://jeongwookie.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
