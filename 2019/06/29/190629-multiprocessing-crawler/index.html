<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1">


  <link rel="mask-icon" href="https://user-images.githubusercontent.com/25416425/45255002-3806e680-b3bc-11e8-8d51-5dde5f6c454d.png?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-1156366976077024",
          enable_page_level_ads: true
     });
</script>

  <meta name="description" content="이번에는 크롤러의 속도를 높이는 방법 중 하나를 알아보자. 우리가 10000개의 유저 데이터를 수집한다고 가정하면, 지금까지는 처음부터 차례대로 하나씩 수집한 것이다. 그런데 만약 동일한 기능을 하는 프로그램 창을 여러개 띄우고, 2500개씩 나누어 4개의 창으로 동시에 데이터를 수집하면 어떨까? 이런 것을 가능하게 하는 것이 바로 파이썬의 기본 모듈 중">
<meta name="keywords" content="Python,Datamining,Twitter">
<meta property="og:type" content="article">
<meta property="og:title" content="Data Crawling - 크롤러 속도를 높이는 멀티프로세싱 (multiprocessing)">
<meta property="og:url" content="https://jeongwookie.github.io/2019/06/29/190629-multiprocessing-crawler/index.html">
<meta property="og:site_name" content="JW&#39;s Blog">
<meta property="og:description" content="이번에는 크롤러의 속도를 높이는 방법 중 하나를 알아보자. 우리가 10000개의 유저 데이터를 수집한다고 가정하면, 지금까지는 처음부터 차례대로 하나씩 수집한 것이다. 그런데 만약 동일한 기능을 하는 프로그램 창을 여러개 띄우고, 2500개씩 나누어 4개의 창으로 동시에 데이터를 수집하면 어떨까? 이런 것을 가능하게 하는 것이 바로 파이썬의 기본 모듈 중">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://user-images.githubusercontent.com/25416425/60382111-6237ab00-9a99-11e9-8500-c76666317467.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/25416425/60386591-e1e16c00-9ad1-11e9-8c41-fca71061bddb.png">
<meta property="og:updated_time" content="2019-06-29T16:06:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Data Crawling - 크롤러 속도를 높이는 멀티프로세싱 (multiprocessing)">
<meta name="twitter:description" content="이번에는 크롤러의 속도를 높이는 방법 중 하나를 알아보자. 우리가 10000개의 유저 데이터를 수집한다고 가정하면, 지금까지는 처음부터 차례대로 하나씩 수집한 것이다. 그런데 만약 동일한 기능을 하는 프로그램 창을 여러개 띄우고, 2500개씩 나누어 4개의 창으로 동시에 데이터를 수집하면 어떨까? 이런 것을 가능하게 하는 것이 바로 파이썬의 기본 모듈 중">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/25416425/60382111-6237ab00-9a99-11e9-8500-c76666317467.png">



  <link rel="alternate" href="/atom.xml" title="JW's Blog" type="application/atom+xml">




  <link rel="canonical" href="https://jeongwookie.github.io/2019/06/29/190629-multiprocessing-crawler/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Data Crawling - 크롤러 속도를 높이는 멀티프로세싱 (multiprocessing) | JW's Blog</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-125636294-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-125636294-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JW's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Make stuff people want</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="https://www.notion.so/jeongwookie93/Jeong-Wook-Kim-03e882670c1949a99d8b408d9785468f" rel="external nofollow noopener noreferrer" target="_blank"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/jeongwookie" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow noopener noreferrer" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jeongwookie.github.io/2019/06/29/190629-multiprocessing-crawler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jeongwook, Kim">
      <meta itemprop="description" content="Love code, travel, and game">
      <meta itemprop="image" content="https://user-images.githubusercontent.com/25416425/59519549-10245080-8f03-11e9-9a48-21e99af119f3.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JW's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Data Crawling - 크롤러 속도를 높이는 멀티프로세싱 (multiprocessing)

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-29 18:01:17" itemprop="dateCreated datePublished" datetime="2019-06-29T18:01:17+09:00">2019-06-29</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Programming/Data-Crawling/" itemprop="url" rel="index"><span itemprop="name">Data Crawling</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2019/06/29/190629-multiprocessing-crawler/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/29/190629-multiprocessing-crawler/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>이번에는 크롤러의 속도를 높이는 방법 중 하나를 알아보자.</p>
<p>우리가 10000개의 유저 데이터를 수집한다고 가정하면, 지금까지는 처음부터 차례대로 하나씩 수집한 것이다.</p>
<p>그런데 만약 동일한 기능을 하는 프로그램 창을 여러개 띄우고, 2500개씩 나누어 4개의 창으로 동시에 데이터를 수집하면 어떨까?</p>
<p>이런 것을 가능하게 하는 것이 바로 파이썬의 기본 모듈 중 하나인 멀티프로세싱 (multiprocessing)이다.</p>
<p><img src="https://user-images.githubusercontent.com/25416425/60382111-6237ab00-9a99-11e9-8500-c76666317467.png" width="450"></p>
<a id="more"></a>
<p>지금부터, 트위터에서 유저 데이터 (username, joined date, total tweets, followings, followers)를 멀티프로세싱을 통해 속도를 개선한 크롤러로 수집해 보겠다.</p>
<p>수집할 트윗은 요즘 결승 라운드를 시작하여 매우 핫한 “슈퍼밴드” 를 포함한 트윗으로, 6월 21일부터 6월 28일까지의 기간으로 정했다.</p>
<p>편의를 위해 트윗을 수집할 때 직접 수집하지 않고 앞서 사용하였던 <strong>GetOldTweet3</strong> 을 임포트 하였다. 자세한 내용은 <a href="https://jeongwookie.github.io/2019/06/10/190610-twitter-data-crawling/">여기</a>를 참고하자.</p>
<h2 id="트윗-수집하기"><a href="#트윗-수집하기" class="headerlink" title="트윗 수집하기"></a>트윗 수집하기</h2><p>먼저, <strong>GetOldTweet3</strong> 을 사용하여 특정 검색어를 포함한 트윗을 먼저 수집하고, 이런 트윗을 작성한 유저들의 닉네임 (username)을 리스트로 반환해 보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import packages</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> GetOldTweets3 <span class="keyword">as</span> got</span><br><span class="line"></span><br><span class="line"><span class="comment"># 트윗 수집하는 함수 정의</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tweets</span><span class="params">(start_date, end_date, keyword)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 범위 끝을 포함하게 만듬</span></span><br><span class="line">    end_date = (datetime.datetime.strptime(end_date, <span class="string">"%Y-%m-%d"</span>) </span><br><span class="line">                + datetime.timedelta(days=<span class="number">1</span>)).strftime(<span class="string">"%Y-%m-%d"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 트윗 수집 기준 설정</span></span><br><span class="line">    tweetCriteria = got.manager.TweetCriteria().setQuerySearch(<span class="string">'&#123;&#125;'</span>.format(keyword))\</span><br><span class="line">                                            .setSince(start_date)\</span><br><span class="line">                                            .setUntil(end_date)\</span><br><span class="line">                                            .setMaxTweets(<span class="number">-1</span>) <span class="comment"># 모두 수집</span></span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"==&gt; Collecting data start.."</span>)</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    tweets = got.manager.TweetManager.getTweets(tweetCriteria)</span><br><span class="line">    print(<span class="string">"==&gt; Collecting data end.. &#123;0:0.2f&#125; minutes"</span>.format((time.time() - start_time)/<span class="number">60</span>))</span><br><span class="line">    print(<span class="string">"=== Total number of tweets is &#123;&#125; ==="</span>.format(len(tweets)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> tweets</span><br><span class="line"></span><br><span class="line"><span class="comment"># 유저 리스트 반환하는 함수 정의</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_users</span><span class="params">(tweets)</span>:</span></span><br><span class="line">    </span><br><span class="line">    user_list = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> tweets:</span><br><span class="line">        username = index.username</span><br><span class="line">        user_list.append(username)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> user_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 유저 리스트 수집하기</span></span><br><span class="line">tweets = get_tweets(<span class="string">"2019-06-21"</span>, <span class="string">"2019-06-28"</span>, <span class="string">"슈퍼밴드"</span>)</span><br><span class="line">users = get_users(tweets)</span><br><span class="line"></span><br><span class="line">&gt; ==&gt; Collecting data start..</span><br><span class="line">&gt; ==&gt; Collecting data end.. 4.45 minutes</span><br><span class="line">&gt; === Total number of tweets <span class="keyword">is</span> <span class="number">3456</span> ===</span><br></pre></td></tr></table></figure>
<p><code>get_tweets()</code>으로 2019년 06월 21일부터 2019년 06년 28일까지 키워드 “슈퍼밴드” 를 포함한 트윗을 먼저 수집하고, <code>get_users()</code>으로 트윗을 작성한 유저의 닉네임을 리스트로 만들어 <code>users</code>에 저장하였다.</p>
<p>총 5분 가량 소요되었고, 조건을 만족하는 트윗은 3456개임을 확인하였다.</p>
<h2 id="logger-정의하기"><a href="#logger-정의하기" class="headerlink" title="logger 정의하기"></a>logger 정의하기</h2><p>본격적으로 멀티프로세싱에 들어가기 전, 효과적으로 결과를 볼 수 있도록 도와주는 로깅 (logging)을 먼저 소개하고자 한다.</p>
<p>로깅 (logging)이란 현재 우리의 프로그램이 어떤 상태를 가지고 있는지 외부 출력을 하게 만들어서, 개발자들이 프로그램의 상황을 직접 눈으로 확인할 수 있도록 하는 것이다.</p>
<p>얼핏 보면 우리가 지금까지 사용한 <code>print()</code>와 유사하지만, 다양한 옵션의 출력을 미리 세팅해 둘 수 있어서 훨씬 유연하게 상황에 따라 대처할 수 있다.</p>
<p>코드부터 살펴보자. 파이썬 기본 모듈이므로 따로 설치할 필요는 없다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line"><span class="comment"># logging 설정</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_logger</span><span class="params">()</span>:</span></span><br><span class="line">    logger = logging.getLogger(<span class="string">"my"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> len(logger.handlers) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> logger</span><br><span class="line">    </span><br><span class="line">    logger.setLevel(logging.INFO)</span><br><span class="line">    stream_hander = logging.StreamHandler()</span><br><span class="line">    logger.addHandler(stream_hander)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> logger</span><br></pre></td></tr></table></figure>
<p><em>my</em> 라는 로거 (logger)를 정의하고, <code>INFO</code> 이상의 등급에 해상하는 로그만 출력하도록 <code>setLevel()</code>을 통해 설정하였다. 또한 프로그램 실행과 동시에 결과를 보여줄 수 있도록 핸들러를 정의하고, 이를 콘솔창에 출력하도록 하였다.</p>
<p>또한, 로그가 중복되어 두번씩 출력되는 현상을 방지하기 위해 <code>logging.handlers</code>를 이미 불러온 경우에는 또 불러오지 않도록 중간에 if문을 넣었다.</p>
<p>대단히 간단한 옵션들만 사용한 것인데, 자세한 내용은 <a href="https://hamait.tistory.com/880" rel="external nofollow noopener noreferrer" target="_blank">이승현님의 블로그</a>를 참고하자. 여러가지 옵션에 대해서 상세히 다루어 놓았다.</p>
<h2 id="유저-데이터-수집하기"><a href="#유저-데이터-수집하기" class="headerlink" title="유저 데이터 수집하기"></a>유저 데이터 수집하기</h2><p>아까 수집해 놓은 유저 닉네임 (username)을 바탕으로, 유저 데이터를 수집해 보자.</p>
<p>수집에 사용할 툴은 <code>bs4</code> 패키지의 <code>BeautlfulSoup</code>이며, <em>lxml</em> 형식으로 데이터를 받아올 것이다. </p>
<p>수집할 유저 데이터는 유저 닉네임, 가입일, 전체 작성 트윗수, 팔로워수, 팔로잉수 이다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crawl_userdata</span><span class="params">(username)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># setting</span></span><br><span class="line">    url = <span class="string">'https://twitter.com/&#123;&#125;'</span>.format(username)</span><br><span class="line">    mylogger.info(<span class="string">"&#123;&#125; 유저의 데이터 수집 시작"</span>.format(username))</span><br><span class="line">    HEADER = &#123;<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'</span>&#125;</span><br><span class="line">    response = requests.get(url, headers=HEADER)</span><br><span class="line">    html = response.text</span><br><span class="line"></span><br><span class="line">    <span class="comment"># parsing</span></span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">"lxml"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># parsing fail</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_profile_header = soup.find(<span class="string">"div"</span>, &#123;<span class="string">"class"</span>:<span class="string">'ProfileHeaderCard'</span>&#125;)</span><br><span class="line">        user_profile_canopy = soup.find(<span class="string">"div"</span>, &#123;<span class="string">"class"</span>:<span class="string">'ProfileCanopy-nav'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># data collect</span></span><br><span class="line">        user = user_profile_header.find(<span class="string">'a'</span>, &#123;<span class="string">'class'</span>:<span class="string">'ProfileHeaderCard-nameLink u-textInheritColor js-nav'</span>&#125;)[<span class="string">'href'</span>].strip(<span class="string">"/"</span>) </span><br><span class="line"></span><br><span class="line">        date_joined = user_profile_header.find(<span class="string">'div'</span>, &#123;<span class="string">'class'</span>:<span class="string">"ProfileHeaderCard-joinDate"</span>&#125;).find(<span class="string">'span'</span>, &#123;<span class="string">'class'</span>:<span class="string">'ProfileHeaderCard-joinDateText js-tooltip u-dir'</span>&#125;)[<span class="string">'title'</span>]</span><br><span class="line">        date_joined = date_joined.split(<span class="string">"-"</span>)[<span class="number">1</span>].strip()</span><br><span class="line">        <span class="keyword">if</span> date_joined <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            data_joined = <span class="string">"Unknown"</span></span><br><span class="line"></span><br><span class="line">        tweets = user_profile_canopy.find(<span class="string">'span'</span>, &#123;<span class="string">'class'</span>:<span class="string">"ProfileNav-value"</span>&#125;)[<span class="string">'data-count'</span>]</span><br><span class="line">        <span class="keyword">if</span> tweets <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            tweets = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        mylogger.info(<span class="string">"&#123;&#125; 유저의 데이터 수집 중 알수없는 오류가 발생했습니다."</span>.format(username))</span><br><span class="line">        mylogger.info(<span class="string">"링크 : &#123;&#125;"</span>.format(url))</span><br><span class="line">        user, date_joined, tweets, following, followers = username, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 블락 계정 특징 : 팔로워, 팔로잉 수가 안보임</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">        test_following = user_profile_canopy.find(<span class="string">'li'</span>, &#123;<span class="string">'class'</span>:<span class="string">"ProfileNav-item ProfileNav-item--following"</span>&#125;)</span><br><span class="line">        test_followers = user_profile_canopy.find(<span class="string">'li'</span>, &#123;<span class="string">'class'</span>:<span class="string">"ProfileNav-item ProfileNav-item--followers"</span>&#125;)</span><br><span class="line"></span><br><span class="line">        following = test_following.find(<span class="string">'span'</span>, &#123;<span class="string">'class'</span>:<span class="string">"ProfileNav-value"</span>&#125;)[<span class="string">'data-count'</span>]</span><br><span class="line">        followers = test_followers.find(<span class="string">'span'</span>, &#123;<span class="string">'class'</span>:<span class="string">"ProfileNav-value"</span>&#125;)[<span class="string">'data-count'</span>]</span><br><span class="line"></span><br><span class="line">        mylogger.info(<span class="string">"&#123;&#125; 유저의 데이터 수집 완료"</span>.format(username))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        mylogger.info(<span class="string">"&#123;&#125; 유저는 블락된 계정입니다."</span>.format(username))</span><br><span class="line">        following = <span class="string">"Block"</span></span><br><span class="line">        followers = <span class="string">"Block"</span></span><br><span class="line"></span><br><span class="line">    result = [user, date_joined, tweets, following, followers]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>트위터 데이터를 어려번 수집하여 보니 안 사실인데, 트위터의 정책상 블락 (block)된 유저들은 가입일이나 전체 작성한 트윗 수 등은 조회가 가능하지만, 팔로잉 수나 팔로워 수는 보이지 않는다. 처음에는 이런 정보를 유저가 선택적으로 오픈할 수 있는 옵션이 있는지 의심했지만, 그런 옵션은 공식적으로 제공하지 않았다.</p>
<p>중간중간에 <code>try-except</code>문을 사용하여 위와 같은 경우를 방지하였다. <code>BeautifulSoup</code>을 통해 원하는 데이터를 수집하는 부분은 따로 설명하지 않았다. 좀 더 알고 싶다면 <a href="https://jeongwookie.github.io/2019/03/18/190318-naver-finance-data-crawling-using-python/">과거에 작성한 글</a>이 있으니 참고.</p>
<h2 id="멀티프로세싱-사용하기"><a href="#멀티프로세싱-사용하기" class="headerlink" title="멀티프로세싱 사용하기"></a>멀티프로세싱 사용하기</h2><p>모든 준비가 끝났다. 이제 실제 코드를 멀티프로세싱을 통해서 병렬화 하여 돌리면 된다. (병렬 크롤링)</p>
<p>유의할 점은, 멀티프로세싱을 사용할 때, <code>main()</code>이 무엇인지 정확히 언급해 주어야 오류를 방지할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 유저 정보 Multiprocessing</span></span><br><span class="line"><span class="keyword">global</span> user_info</span><br><span class="line">user_info = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    user_list = users</span><br><span class="line">    pool_size = len(user_list)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> pool_size &lt; <span class="number">8</span>:</span><br><span class="line">        pool = Pool(pool_size)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pool = Pool(<span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> pool.map(crawl_userdata, user_list):</span><br><span class="line">        user_info.append(user)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    </span><br><span class="line">    start_time = time.time()</span><br><span class="line">    </span><br><span class="line">    mylogger = get_logger()</span><br><span class="line">    mylogger.info(<span class="string">"유저 정보 수집 시작"</span>)</span><br><span class="line">    </span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line">    end_time = (time.time() - start_time)/<span class="number">60</span></span><br><span class="line">    mylogger.info(<span class="string">"유저 정보 수집 종료.. &#123;0:0.2f&#125; 분 소요"</span>.format(end_time))</span><br><span class="line">    mylogger.info(<span class="string">"총 수집된 유저 정보는 &#123;&#125; 개 입니다."</span>.format(len(user_info)))</span><br></pre></td></tr></table></figure>
<p><code>Pool</code>은, 몇개의 창을 열어서 동시에 프로그램을 돌릴지 정의하는 함수이다. 위 코드에서는 우리가 수집할 데이터의 갯수가 8 이하일 경우에는 그 숫지만큼, 아닐 경우 8개를 동시에 실행해서 수집하도록 셋팅하였다.</p>
<p>이어서 <code>pool.map()</code>으로 적용하고 싶은 함수 <code>crawl_userdata()</code>와 그 적용 대상이 되는 <code>user_list</code>을 차례로 적고 for문을 완성한다.</p>
<p>위 코드를 실행시켜보면, 총 3456개의 유저 정보가 <u>단 10분만에 크롤링 됨</u>을 확인할 수 있다.</p>
<p><img src="https://user-images.githubusercontent.com/25416425/60386591-e1e16c00-9ad1-11e9-8c41-fca71061bddb.png" width="700"></p>
<p>결과가 어떤 형태로 나오는지 보여주기 위해, 해당 트윗도 추가해서 위와 같이 출력해 보았다.</p>
<p>위의 정보 뿐만 아니라 트윗의 업로드 시각, 리트윗 수, 관심글 수, 지역 등의 데이터를 추가로 수집 가능하다.</p>
<p>이전 다루었던 트위터 데이터 크롤링의 코드로 실행하면 거의 3시간씩 걸린 작업을 멀티 프로세싱을 통해 대단히 빠른 속도로 시간을 단축시켜 보았다.</p>
<p>하지만, 이는 공격적인 크롤링으로 오인받아 일부 사이트의 경우 차단당할 우려가 있으므로.. 상황에 맞게 조심스레(?) 사용하자.</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/Datamining/" rel="tag"># Datamining</a>
          
            <a href="/tags/Twitter/" rel="tag"># Twitter</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/28/190628-spring-semester-finish/" rel="next" title="19년 카이스트 봄학기 후기">
                <i class="fa fa-chevron-left"></i> 19년 카이스트 봄학기 후기
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/23/190723-my-summer-these-days/" rel="prev" title="2019년 여름, 연구실에서 근황">
                2019년 여름, 연구실에서 근황 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://user-images.githubusercontent.com/25416425/59519549-10245080-8f03-11e9-9a48-21e99af119f3.jpg" alt="Jeongwook, Kim">
            
              <p class="site-author-name" itemprop="name">Jeongwook, Kim</p>
              <div class="site-description motion-element" itemprop="description">Love code, travel, and game</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">50</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">32</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/jeongwookie" title="Github &rarr; https://github.com/jeongwookie" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:captainfox@kaist.ac.kr" title="E-Mail &rarr; mailto:captainfox@kaist.ac.kr" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://www.linkedin.com/in/jeongwook-kim/" title="linkedin &rarr; https://www.linkedin.com/in/jeongwook-kim/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#트윗-수집하기"><span class="nav-number">1.</span> <span class="nav-text">트윗 수집하기</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#logger-정의하기"><span class="nav-number">2.</span> <span class="nav-text">logger 정의하기</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#유저-데이터-수집하기"><span class="nav-number">3.</span> <span class="nav-text">유저 데이터 수집하기</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#멀티프로세싱-사용하기"><span class="nav-number">4.</span> <span class="nav-text">멀티프로세싱 사용하기</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      
    </div>
    <div class="gooAd sidebar-inner" style"display: block;">
      <!-- Google AdSense start -->
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- jw google ad 1 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1156366976077024" data-ad-slot="2477415640" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
      <!-- Google AdSense end -->
    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jeongwook, Kim</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> v3.8.0</div>








        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://jeongwookie.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "https://jeongwookie.github.io/2019/06/29/190629-multiprocessing-crawler/";
    this.page.identifier = "2019/06/29/190629-multiprocessing-crawler/";
    this.page.title = 'Data Crawling - 크롤러 속도를 높이는 멀티프로세싱 (multiprocessing)';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://jeongwookie.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
